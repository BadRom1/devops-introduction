---
phase: 01-nettoyage-technique
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: [components/CalmsBlock.vue, slides.md]
autonomous: true

must_haves:
  truths:
    - "Le style CSS CALMS est defini une seule fois dans CalmsBlock.vue, et les 6 slides CALMS l'utilisent via le composant"
    - "Chaque slide CALMS affiche le bon bloc en surbrillance (les autres a 50% d'opacite)"
    - "La slide 'Apparition des principes' affiche tous les blocs a 100% (pas de highlight)"
    - "La presentation se build et les slides CALMS s'affichent correctement"
  artifacts:
    - path: "components/CalmsBlock.vue"
      provides: "Composant Vue reutilisable pour la visualisation CALMS"
      min_lines: 60
    - path: "slides.md"
      provides: "Slides CALMS utilisant le composant au lieu du HTML+CSS duplique"
      contains: "<CalmsBlock"
  key_links:
    - from: "slides.md"
      to: "components/CalmsBlock.vue"
      via: "Slidev auto-discovery des composants dans components/"
      pattern: "<CalmsBlock"
    - from: "CalmsBlock.vue"
      to: "highlight prop"
      via: "Vue defineProps avec validator"
      pattern: "defineProps"
---

<objective>
Extraire le HTML+CSS CALMS duplique 6 fois dans slides.md vers un composant Vue reutilisable CalmsBlock.vue avec une prop `highlight` pour gerer les variations de surbrillance.

Purpose: Eliminer ~350 lignes de code duplique (6 x ~60 lignes CSS + HTML) en un seul composant de ~80 lignes. Cela rend le CSS maintenable pour les phases suivantes qui ajouteront du contenu et potentiellement de nouvelles references au CALMS.
Output: components/CalmsBlock.vue cree, slides.md allegee d'environ 300 lignes de duplication.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-nettoyage-technique/01-RESEARCH.md
@.planning/phases/01-nettoyage-technique/01-01-SUMMARY.md
@slides.md
@components/Counter.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Creer le composant CalmsBlock.vue</name>
  <files>components/CalmsBlock.vue</files>
  <action>
Creer le fichier `components/CalmsBlock.vue` en suivant le pattern documente dans la RESEARCH.md. Le composant doit :

1. **Script setup TypeScript** : Definir une prop `highlight` de type String avec valeur par defaut `'none'` et un validator qui accepte : `'culture'`, `'automation'`, `'lean'`, `'measurement'`, `'share'`, `'none'`.

2. **Template** : Reproduire exactement la structure HTML des blocs CALMS telle qu'elle existe dans slides.md (lignes 303-321). Utiliser `:class="{ dimmed: highlight !== 'xxx' && highlight !== 'none' }"` sur chaque bloc pour gerer la surbrillance dynamiquement.

Structure du template :
```
div.calms-container
  div.ligne1
    div.block.automation  (texte: AUTOMATION)
    div.block.lean        (texte: LEAN)
    div.block.measurement (texte: MEASUREMENT)
    div.block.share       (texte: SHARE)
  div.block.culture.ligne2 (texte: CULTURE)
```

Chaque `.block` recoit `:class="{ dimmed: highlight !== '[name]' && highlight !== 'none' }"` ou `[name]` est le nom du bloc.

3. **Style scoped** : Inclure TOUT le CSS CALMS dans un bloc `<style scoped>`. Reprendre les styles exacts de slides.md (lignes 327-379) comme base, PLUS la classe `.dimmed { opacity: 0.5; }`.

Les couleurs exactes a respecter (extraites du code actuel) :
- `.culture` : `background-color: green`
- `.automation` : `background-color: #FFB612`, `writing-mode: vertical-rl`, `rotate: 180deg`
- `.lean` : `background-color: #A1006B`, `writing-mode: vertical-rl`, `rotate: 180deg`
- `.measurement` : `background-color: #00A1DE`, `writing-mode: vertical-rl`, `rotate: 180deg`
- `.share` : `background-color: red`, `writing-mode: vertical-rl`, `rotate: 180deg`

**Important** : Ne PAS utiliser de child combinators (`.a > .b`) dans le scoped CSS -- Slidev/Vue les casse avec le scoping mechanism.

**Reference** : Regarder `components/Counter.vue` pour le pattern `<script setup>` existant dans le projet.
  </action>
  <verify>
1. Le fichier `components/CalmsBlock.vue` existe
2. Il contient `defineProps` avec la prop `highlight`
3. Il contient les 5 classes de couleur (culture, automation, lean, measurement, share)
4. Il contient la classe `.dimmed` avec `opacity: 0.5`
5. Le template contient 5 blocs avec des `:class` conditionnels
  </verify>
  <done>Le composant CalmsBlock.vue est cree dans components/ avec la prop highlight, le template HTML CALMS, et le CSS scoped complet incluant la classe dimmed.</done>
</task>

<task type="auto">
  <name>Task 2: Remplacer le HTML+CSS duplique dans slides.md par le composant</name>
  <files>slides.md</files>
  <action>
Remplacer les 6 occurrences du bloc HTML+CSS CALMS dans slides.md par des appels au composant `<CalmsBlock />`.

Les 6 slides CALMS a modifier (identifiees par leur titre h1 et le comportement de highlight) :

1. **"Apparition des principes"** (~lignes 301-380) : Tous les blocs a 100% opacite.
   - Remplacer le div.calms-container + tout le bloc `<style>` CALMS par : `<CalmsBlock />`
   - Conserver le `<style>` UNIQUEMENT pour `h1 { color: #2B90B6; }` (ce n'est pas du CALMS CSS)

2. **"Culture"** (~lignes 403-483) : Culture a 100%, les 4 blocs du haut (ligne1) a 50%.
   - Remplacer par : `<CalmsBlock highlight="culture" />`
   - Conserver `h1 { color: #2B90B6; }`

3. **"Automatisation"** (~lignes 503-585) : Automation a 100%, culture + lean + measurement + share a 50%.
   - Remplacer par : `<CalmsBlock highlight="automation" />`
   - Conserver `h1 { color: #2B90B6; }`

4. **"Lean"** (~lignes 605-687) : Lean a 100%, les autres a 50%.
   - Remplacer par : `<CalmsBlock highlight="lean" />`
   - Conserver `h1 { color: #2B90B6; }`

5. **"Mesure"** (~lignes 707-789) : Measurement a 100%, les autres a 50%.
   - Remplacer par : `<CalmsBlock highlight="measurement" />`
   - Conserver `h1 { color: #2B90B6; }`

6. **"Partage"** (~lignes 816-898) : Share a 100%, les autres a 50%.
   - Remplacer par : `<CalmsBlock highlight="share" />`
   - Conserver `h1 { color: #2B90B6; }`

**Pour chaque slide, le pattern de remplacement est :**

AVANT (dans la partie `::right::`) :
```markdown
::right::

<div class="calms-container">
  ... 15-20 lignes de HTML ...
</div>

<style>
h1 { color: #2B90B6; }
... 50-60 lignes de CSS CALMS ...
</style>
```

APRES :
```markdown
::right::

<CalmsBlock highlight="xxx" />

<style>
h1 {
  color: #2B90B6;
}
</style>
```

(Pour la slide "Apparition des principes", utiliser `<CalmsBlock />` sans prop highlight.)

**Attention** :
- Preserver les commentaires HTML (`<!-- ... -->`) de chaque slide
- Preserver les separateurs de slides (`---`) et le frontmatter de chaque slide (layout, transition)
- Preserver le texte du cote gauche (::left:: implicite) de chaque slide
- Ne PAS toucher aux slides qui ne contiennent pas le bloc CALMS
- Le nombre total de slides doit rester identique

**Verification de coherence** : Apres remplacement, la slide Culture doit avoir `highlight="culture"` (pas "Culture" avec majuscule). Utiliser les noms en minuscule qui correspondent aux classes CSS.
  </action>
  <verify>
1. `grep -c "CalmsBlock" slides.md` retourne 6 (une par slide CALMS)
2. `grep -c "calms-container" slides.md` retourne 0 (tout le HTML inline supprime)
3. `grep -c '\.calms-container' slides.md` retourne 0 (tout le CSS inline CALMS supprime)
4. `grep -c 'highlight=' slides.md` retourne 5 (les 5 slides avec un highlight specifique)
5. `grep -c "CalmsBlock /" slides.md` retourne 1 (la slide "Apparition des principes" sans highlight)
6. `pnpm run build` se termine sans erreur (le composant est auto-decouvert par Slidev)
7. Le nombre de `---` dans slides.md n'a pas change (les separateurs de slides sont preserves)
  </verify>
  <done>Les 6 blocs HTML+CSS CALMS dupliques sont remplaces par `<CalmsBlock />` avec la prop highlight appropriee. Le CSS CALMS n'existe plus qu'une seule fois dans CalmsBlock.vue. Le build passe sans erreur.</done>
</task>

</tasks>

<verification>
1. `pnpm run build` sans erreur -- confirme que le composant est correctement auto-decouvert et que le template est valide
2. `grep -c "calms-container" slides.md` retourne 0 -- aucun HTML CALMS inline restant
3. `grep -c "CalmsBlock" slides.md` retourne 6 -- toutes les slides utilisent le composant
4. `wc -l slides.md` montre une reduction significative (~300 lignes en moins par rapport a l'original)
5. Le fichier `components/CalmsBlock.vue` contient un `<style scoped>` avec les classes CALMS
</verification>

<success_criteria>
- CalmsBlock.vue existe dans components/ et contient la prop highlight avec validator
- Les 6 slides CALMS utilisent `<CalmsBlock />` au lieu du HTML+CSS inline
- Zero occurrence de `.calms-container` dans les blocs `<style>` de slides.md
- `pnpm run build` se termine avec exit code 0
- slides.md a perdu environ 300 lignes (duplication eliminee)
</success_criteria>

<output>
After completion, create `.planning/phases/01-nettoyage-technique/01-02-SUMMARY.md`
</output>
